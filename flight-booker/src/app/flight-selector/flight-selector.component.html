<h3>Available Flights</h3>
<div class="filter-and-sort">
    <mat-expansion-panel>
        <mat-expansion-panel-header>
            <mat-panel-title>Sort and Filter</mat-panel-title>
        </mat-expansion-panel-header>
        <mat-grid-list cols="5" rowHeight="13rem">
            <mat-grid-tile [colspan]="4">
                <mat-card appearance="outlined" class="filter-card">
                    <mat-card-header>
                        <mat-card-title>Filter</mat-card-title>
                    </mat-card-header>
                    <mat-card-content class="filters">
                        <div class="filter">
                            <div class="price-filter">
                                <mat-label>Price</mat-label>
                                <p *ngIf="selectedMaxPrice === maxPrice">Showing all prices</p>
                                <p *ngIf="selectedMaxPrice !== maxPrice">Showing prices up to ${{selectedMaxPrice}}</p>
                                <mat-slider min="0" [max]="maxPrice" [discrete]="true" (input)="filterByPrice()" class="price-slider">
                                    <input [(ngModel)]="selectedMaxPrice" matSliderThumb>
                                </mat-slider>
                                <section>
                                    <mat-checkbox [(ngModel)]="filterEconomy" (click)="onFareClassFilterChange()">Economy</mat-checkbox>
                                    <mat-checkbox [(ngModel)]="filterBusiness" (click)="onFareClassFilterChange()">Business</mat-checkbox>
                                    <mat-checkbox [(ngModel)]="filterFirst" (click)="onFareClassFilterChange()">First</mat-checkbox>
                                </section>
                            </div>
                        </div>
                        <div class="filter">
                            <mat-form-field>
                                <mat-label>Airline</mat-label>
                                <mat-select [formControl]="chosenAirlines" (selectionChange)="filterByAirline()" multiple>
                                        <mat-option *ngFor="let airline of availableAirlines" [value]="airline">{{airline}}</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                    </mat-card-content>
                </mat-card>
            </mat-grid-tile>
            <mat-grid-tile [colspan]="1">
                <mat-card appearance="outlined">
                    <mat-card-header>
                        <mat-card-title>Sort</mat-card-title>
                    </mat-card-header>
                    <mat-card-content>
                        <mat-form-field>
                            <mat-label>Sort By</mat-label>
                            <mat-select [formControl]="sortOption" (selectionChange)="sortFlights()">
                                <mat-option value="price">Price</mat-option>
                                <mat-option value="duration">Duration</mat-option>
                                <mat-option value="departureTime">Departure Time</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </mat-card-content>
                </mat-card>
            </mat-grid-tile>
        </mat-grid-list>
    </mat-expansion-panel>
</div>
<mat-spinner *ngIf="this.loading" [diameter]="50" class="loading-spinner"></mat-spinner>
<div class="flight-selection">
    <mat-accordion multi>
        <mat-expansion-panel *ngFor="let flight of availableFlights">
            <mat-expansion-panel-header>
                <mat-panel-title>{{convertTime(flight.departureTime)}} - {{convertTime(flight.arrivalTime)}}</mat-panel-title>
                <mat-panel-description>{{convertDuration(flight.duration)}}</mat-panel-description>
                <mat-panel-description>
                    {{flight.originCode}} 
                    <mat-icon aria-hidden="false" fontIcon="trending_flat"></mat-icon>
                    {{flight.destinationCode}}
                </mat-panel-description>
                <mat-panel-description>{{flight.airline}}</mat-panel-description>
                <mat-panel-description>${{getDisplayPrice(flight)}}</mat-panel-description>
            </mat-expansion-panel-header>
            <mat-grid-list cols="3" rowHeight="15rem">
                <mat-grid-tile>
                    <mat-card appearance="outlined">
                        <mat-card-header>
                            <mat-card-title>Economy Class</mat-card-title>
                            <mat-card-subtitle>${{flight.economyPrice}}</mat-card-subtitle>
                        </mat-card-header>
                        <mat-card-content>
                            <div>Depart: {{convertTime(flight.departureTime)}}</div>
                            <div>Arrive: {{convertTime(flight.arrivalTime)}}</div>
                            <div>Duration: {{convertDuration(flight.duration)}}</div>
                        </mat-card-content>
                        <mat-card-actions>
                            <button mat-stroked-button (click)="selectFlight(flight.id, 'Economy')" [routerLink]="['/reserve']">Select</button>
                        </mat-card-actions>
                    </mat-card>
                </mat-grid-tile>
                <mat-grid-tile>
                    <mat-card appearance="outlined">
                        <mat-card-header>
                            <mat-card-title>Business Class</mat-card-title>
                            <mat-card-subtitle>${{flight.businessPrice}}</mat-card-subtitle>
                        </mat-card-header>
                        <mat-card-content>
                            <div>Depart: {{convertTime(flight.departureTime)}}</div>
                            <div>Arrive: {{convertTime(flight.arrivalTime)}}</div>
                            <div>Duration: {{convertDuration(flight.duration)}}</div>
                        </mat-card-content>
                        <mat-card-actions>
                            <button mat-stroked-button (click)="selectFlight(flight.id, 'Business')" [routerLink]="['/reserve']">Select</button>
                        </mat-card-actions>
                    </mat-card>
                </mat-grid-tile>
                <mat-grid-tile>
                    <mat-card appearance="outlined">
                        <mat-card-header>
                            <mat-card-title>First Class</mat-card-title>
                            <mat-card-subtitle>${{flight.firstPrice}}</mat-card-subtitle>
                        </mat-card-header>
                        <mat-card-content>
                            <div>Depart: {{convertTime(flight.departureTime)}}</div>
                            <div>Arrive: {{convertTime(flight.arrivalTime)}}</div>
                            <div>Duration: {{convertDuration(flight.duration)}}</div>
                        </mat-card-content>
                        <mat-card-actions>
                            <button mat-stroked-button (click)="selectFlight(flight.id, 'First')" [routerLink]="['/reserve']">Select</button>
                        </mat-card-actions>
                    </mat-card>
                </mat-grid-tile>
            </mat-grid-list>
        </mat-expansion-panel>
    </mat-accordion>
</div>
@if (availableFlights.length == 0) {
    <p>No flights found.</p>
}